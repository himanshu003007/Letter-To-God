<!DOCTYPE html>
<html>
<head>
  <title>Join Group</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <h2>Join Existing Group</h2>
  <form id="join-group-form">
    <input type="text" id="group-name" placeholder="Group Name" required><br><br>
    <input type="password" id="group-password" placeholder="Group Password" required><br><br>
    <button type="submit">Join Group</button>
  </form>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBKlOPu9Z_OdO5hobNTrDLh5rOK_KojZvk",
      authDomain: "private-chats-9203c.firebaseapp.com",
      projectId: "private-chats-9203c",
      storageBucket: "private-chats-9203c.appspot.com",
      messagingSenderId: "421397155816",
      appId: "1:421397155816:web:84b3cdc9218355c34a1e5d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    document.getElementById("join-group-form").addEventListener("submit", async function(e) {
      e.preventDefault();
      const groupName = document.getElementById("group-name").value;
      const groupPassword = document.getElementById("group-password").value;

      try {
        const doc = await db.collection("groups").doc(groupName).get();
        if (!doc.exists) {
          alert("Group not found!");
          return;
        }

        if (doc.data().password === groupPassword) {
          // Save group name to local storage for chat use
          localStorage.setItem("joinedGroup", groupName);
          window.location.href = "chat.html";
        } else {
          alert("Incorrect password!");
        }
      } catch (error) {
        alert("Error joining group: " + error.message);
      }
    });
  </script>
</body>
</html>
